<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Qual é a tatuagem certa pra você?</title>
<style>
  :root{
    --bg:#f7f7f8; --card:#fff; --ink:#111; --muted:#666; --line:#e6e6e8;
    --radius:16px;
    --accent:#7A8B55; /* Pantone 17-0336 TCX Moss Green (aprox.) */
    --accent-ink:#fff;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;background:var(--bg);color:var(--ink)}
  .wrap{max-width:860px;margin:0 auto;padding:24px}
  header h1{font-size:clamp(22px,2.8vw,34px);margin:10px 0 4px}
  header p{color:var(--muted);margin:0 0 12px;font-size:clamp(14px,2vw,18px)}
  .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:0 6px 16px rgba(0,0,0,.04);padding:20px}
  .row{display:grid;grid-template-columns:1fr;gap:12px}
  @media (min-width:720px){.row2{grid-template-columns:1fr 1fr}}
  .title{font-size:20px;margin:0 0 6px}
  .muted{color:var(--muted);font-size:13px}
  .btn{appearance:none;border:1px solid var(--line);background:#fff;color:var(--ink);border-radius:12px;padding:12px 14px;text-align:left;cursor:pointer;transition:.2s}
  .btn:hover{border-color:#111}
  .btn.primary{text-align:center;background:var(--accent);color:var(--accent-ink);border-color:var(--accent)}
  .btn.block{width:100%}
  .btn.sel{border-color:var(--accent)}
  .btn[disabled]{opacity:.6;cursor:not-allowed}
  .btn:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
  .actions{display:flex;justify-content:space-between;gap:10px;margin-top:10px}
  .prog{height:8px;background:#e9e9ec;border-radius:999px;overflow:hidden;margin:10px 0 16px}
  .prog>i{display:block;height:100%;background:var(--accent);width:0}
  input[type="text"]{width:100%;padding:12px;border:1px solid #d9d9df;border-radius:12px}
  .kicker{font-size:12px;text-transform:uppercase;color:var(--muted);margin-top:14px}
  .footer{margin:24px 0 10px;text-align:center;color:#888;font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Qual é a tatuagem certa pra você?</h1>
    <p>Responda algumas perguntas rápidas e descubra o desenho, o tamanho e o local perfeitos para o seu estilo.</p>
  </header>

  <div id="app"></div>

  <div class="footer">© <span id="year"></span> • Feito com carinho por Laís • Uberaba-MG</div>
</div>

<script>
(function(){
  // ===== CONFIG =====
  const HOURLY = 150;                 // R$/hora (interno)
  const FORMSPREE_ENDPOINT = "";      // <<<<<< COLE AQUI SUA URL do Formspree (ex.: "https://formspree.io/f/XXXXYYYY")

  // ===== UTIL =====
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));

  // helper de elementos — CORRIGIDO para atributos booleanos
  const el = (tag, attrs = {}, ...kids) => {
    const n = document.createElement(tag);
    if (tag === "button" && !("type" in attrs)) n.setAttribute("type","button"); // nunca submit

    const boolAttrs = new Set([
      "disabled","checked","selected","readonly","multiple",
      "required","autofocus","hidden"
    ]);

    Object.entries(attrs).forEach(([k,v])=>{
      if (k==="class") {
        n.className = v;
      } else if (k==="html") {
        n.innerHTML = v;
      } else if (k.startsWith("on")) {
        n.addEventListener(k.slice(2).toLowerCase(), v);
      } else if (boolAttrs.has(k)) {
        if (v) n.setAttribute(k,"");
        else n.removeAttribute(k);
      } else if (v !== false && v != null) {
        n.setAttribute(k, String(v));
      }
    });

    kids.forEach(k=>{ if(k==null) return; n.appendChild(typeof k==="string"?document.createTextNode(k):k); });
    return n;
  };

  // ===== PERGUNTAS =====
  const Q = [
    { id:"nome", t:"Qual é o seu nome?", type:"text", req:false, ph:"Digite seu nome" },

    { id:"experiencia", t:"Você já tem tatuagens ou seria a sua primeira?", type:"single",
      options:[
        {label:"Será minha primeira — ainda tenho algumas dúvidas e receios.", tags:{first:true}},
        {label:"Já tenho — quero complementar ou fazer algo novo.",           tags:{first:false}},
      ]},

    { id:"receio", t:"Qual é o seu maior receio em relação à tatuagem?", type:"single",
      options:[
        {label:"Arrependimento",tags:{fear:"arrependimento"}},
        {label:"Julgamento",    tags:{fear:"julgamento"}},
        {label:"Dor",           tags:{fear:"dor"}},
        {label:"Custo",         tags:{fear:"custo"}},
        {label:"Nenhum",        tags:{fear:"nenhum"}},
      ]},

    { id:"perfil", t:"Qual dessas descrições mais combina com você?", type:"single",
      options:[
        {label:"Autêntico(a) / Criativo(a) — tatuagem como arte no corpo.", tags:{persona:"artistico"}},
        {label:"Romântico(a) / Emocional — valorizo sentimentos e memórias.", tags:{persona:"romantico"}},
        {label:"Rebelde / Questionador(a) — força e atitude.", tags:{persona:"rebelde"}},
        {label:"Espiritual / Místico(a) — conexão e proteção.", tags:{persona:"mistico"}},
        {label:"Social / Estético(a) — moda, cultura pop, identidade de grupo.", tags:{persona:"social"}},
      ]},

    { id:"comunicar", t:"O que você mais quer comunicar com essa tatuagem?", type:"single",
      options:[
        {label:"Expressão", tags:{motive:"expressao"}},
        {label:"Homenagem", tags:{motive:"homenagem"}},
        {label:"Atitude",   tags:{motive:"atitude"}},
        {label:"Fé/Propósito", tags:{motive:"fe"}},
        {label:"Estética",  tags:{motive:"estetica"}},
      ]},

    { id:"estilo", t:"Qual estilo mais combina com você? (calibra linguagem)", type:"single",
      options:[
        {label:"Fine Line — traços finos e minimalistas", tags:{prefStyle:"fineline"}},
        {label:"Blackwork — preto intenso e contrastes",  tags:{prefStyle:"blackwork"}},
        {label:"Realismo",                                tags:{prefStyle:"realismo"}},  /* renomeado */
      ]},

    { id:"universo", t:"Qual universo estético mais combina com você?", type:"single",
      options:[
        {label:"Clássico",  tags:{universe:"classico"}},
        {label:"Pop-Geek",  tags:{universe:"pop"}},
        {label:"Natureza",  tags:{universe:"natureza"}},
        {label:"Mitologia", tags:{universe:"mitologia"}},
        {label:"Retratos",  tags:{universe:"retrato"}},
      ]},

    { id:"visibilidade", t:"Você quer que sua tatuagem apareça no dia a dia?", type:"single",
      options:[
        {label:"Discreta",    tags:{vis:"baixa"}},
        {label:"Moderada",    tags:{vis:"media"}},
        {label:"Bem visível", tags:{vis:"alta"}},
      ]},

    { id:"trabalho", t:"Como é o seu ambiente de trabalho em relação a tatuagens?", type:"single",
      options:[
        {label:"Formal",  tags:{work:"formal"}},
        {label:"Híbrido", tags:{work:"hibrido"}},
        {label:"Liberal", tags:{work:"liberal"}},
      ]},

    { id:"volubilidade", t:"Você enjoa fácil de coisas visuais?", type:"single",
      options:[
        {label:"Sim — prefiro não ver o tempo todo", tags:{volu:"alta"}},
        {label:"Mais ou menos",                      tags:{volu:"media"}},
        {label:"Não",                                tags:{volu:"baixa"}},
      ]},

    { id:"dor", t:"Como você lida com dor durante procedimentos?", type:"single",
      options:[
        {label:"Baixa tolerância", tags:{pain:"baixa"}},
        {label:"Média",            tags:{pain:"media"}},
        {label:"Alta tolerância",  tags:{pain:"alta"}},
      ]},

    { id:"tempoSessao", t:"Quanto tempo você topa ficar em uma sessão?", type:"single",
      options:[
        {label:"1–2h",               tags:{session:"curta"}},
        {label:"3–4h",               tags:{session:"media"}},
        {label:"5–6h",               tags:{session:"longa"}},
        {label:"Mais de uma sessão", tags:{session:"multi"}},
      ]},

    { id:"diaSemana", t:"Dias preferidos para tatuar", type:"single",
      options:[
        {label:"Dias úteis",       tags:{day:"uteis"}},
        {label:"Finais de semana", tags:{day:"fds"}},
        {label:"Qualquer",         tags:{day:"qualquer"}},
      ]},

    { id:"periodoDia", t:"Período do dia preferido", type:"single",
      options:[
        {label:"Manhã",       tags:{period:"manha"}},
        {label:"Tarde",       tags:{period:"tarde"}},
        {label:"Noite",       tags:{period:"noite"}},
        {label:"Indiferente", tags:{period:"indiferente"}},
      ]},

    { id:"investimento", t:"Qual faixa de investimento você considera? (interno, não exibimos valores)", type:"single",
      options:[
        {label:"R$ 150 – R$ 600",     tags:{budgetMin:150,budgetMax:600}},
        {label:"R$ 600 – R$ 1.200",   tags:{budgetMin:600,budgetMax:1200}},
        {label:"R$ 1.200 – R$ 2.500", tags:{budgetMin:1200,budgetMax:2500}},
        {label:"A partir de R$ 2.500",tags:{budgetMin:2500,budgetMax:999999}},
      ]},

    { id:"homenagem", t:"Sua tatuagem seria uma homenagem?", type:"single",
      options:[
        {label:"Pessoa querida",      tags:{tribute:"pessoa"}},
        {label:"Pet",                 tags:{tribute:"pet"}},
        {label:"Fé/Espiritualidade",  tags:{tribute:"fe"}},
        {label:"Talvez",              tags:{tribute:"talvez"}},
        {label:"Não",                 tags:{tribute:"nao"}},
      ]},

    { id:"presenca", t:"Qual presença você deseja?", type:"single",
      options:[
        {label:"Discreta",     tags:{presence:"discreta"}},
        {label:"Equilibrada",  tags:{presence:"equilibrada"}},
        {label:"Impactante",   tags:{presence:"impactante"}},
      ]},

    { id:"areas", t:"Áreas preferidas (opcional)", type:"multi",
      options:[
        {label:"Braço (antebraço/bíceps/ombro)", tags:{area:"braco"}},
        {label:"Perna (coxa/panturrilha)",       tags:{area:"perna"}},
        {label:"Costas (alta ou média)",         tags:{area:"costas"}},
        {label:"Tórax/Peito",                    tags:{area:"peito"}},
        {label:"Costela/Lateral",                tags:{area:"costela"}},
        {label:"Mão/Punho",                      tags:{area:"mao"}},
        {label:"Pescoço",                        tags:{area:"pescoco"}},
        {label:"Sem preferência",                tags:{area:"nenhuma"}},
      ]},

    { id:"astrologia", t:"Inspiração astrológica? (opcional)", type:"single",
      options:[
        {label:"Não",   tags:{astro:null}},
        {label:"Água",  tags:{astro:"agua"}},
        {label:"Fogo",  tags:{astro:"fogo"}},
        {label:"Terra", tags:{astro:"terra"}},
        {label:"Ar",    tags:{astro:"ar"}},
      ]},

    { id:"valores", t:"Valores/simbologia (opcional)", type:"single",
      options:[
        {label:"Sem símbolos",   tags:{values:null}},
        {label:"Autenticidade",  tags:{values:"autenticidade"}},
        {label:"Natureza",       tags:{values:"natureza"}},
        {label:"Fé",             tags:{values:"fe"}},
      ]},

    { id:"musica", t:"Música/cultura influencia? (opcional)", type:"single",
      options:[
        {label:"Não muito", tags:{music:null}},
        {label:"Rock",      tags:{music:"rock"}},
        {label:"MPB/Indie", tags:{music:"mpb"}},
        {label:"Pop",       tags:{music:"pop"}},
        {label:"Rap/Trap",  tags:{music:"rap"}},
        {label:"Clássica",  tags:{music:"classica"}},
      ]},
  ];

  // ===== REGRAS =====
  const THEME_BY_PERSONA = {
    romantico:["flores/rosas realistas","mãos entrelaçadas","retrato de homenagem"],
    rebelde:["caveira simbólica","gladiador/templário","predador (lobo/tigre)"],
    mistico:["olho místico","símbolo de proteção (São Bento)","mandala realista"],
    artistico:["composição de luz & sombra","retrato artístico","natureza dramática"],
    social:["ícone cultural realista","estudo fotográfico estiloso","objeto icônico"],
  };
  const CULTURE_MOD = {
    classico:["escultura/estátua realista","mãos caravaggescas"],
    pop:["referência cinematográfica sutil","ícone pop em realismo"],
    natureza:["botânica realista","ave/mamífero em close"],
    mitologia:["medusa/greco-romano","guerreiro(a) mitológico(a)"],
    retrato:["retrato humano","close dramático"],
  };
  const PLACEMENTS = { alta:["antebraço externo","panturrilha","antebraço interno"], media:["bíceps","coxa","ombro"], baixa:["costela","tórax/peito","alta das costas"] };
  const LESS_SEEN=["costela","alta das costas","lateral de coxa"];
  const LOW_PAIN=["antebraço","coxa","panturrilha","ombro"];
  const SIZE_CM = { pequeno:"6–9 cm", medio:"12–18 cm", grande:"20–30 cm", projeto:"área maior em várias sessões (40+ cm no total por área)" };

  const hoursFromBudget=(min,max)=>clamp(Math.round(((min+max)/2)/HOURLY),1,24);
  function sizeFromTime(h,multi=false){
    if(multi||h>=8) return {size:"projeto",label:"Projeto"};
    if(h>=4) return {size:"grande",label:"Grande"};
    if(h>=2) return {size:"medio",label:"Médio"};
    return {size:"pequeno",label:"Pequeno"};
  }
  function tone(persona){
    switch(persona){
      case"romantico":return{themeLine:"um registro de afeto e memória"};
      case"rebelde":return{themeLine:"presença e atitude"};
      case"mistico":return{themeLine:"significado e proteção"};
      case"artistico":return{themeLine:"luz e sombra em arte pessoal"};
      case"social":return{themeLine:"estilo alinhado à sua vibe"};
      default:return{themeLine:"estilo que representa quem você é"};
    }
  }

  function buildInspiration(tags){
    const parts=[];
    if(tags.astro==="agua") parts.push("linhas fluidas, composição com movimento e transições suaves");
    if(tags.astro==="fogo") parts.push("contrastes intensos e direção de luz dramática para energia");
    if(tags.astro==="terra") parts.push("texturas orgânicas (folhas, rochas) e sensação de estabilidade");
    if(tags.astro==="ar") parts.push("composição leve/arejada e espaços negativos bem trabalhados");

    if(tags.values==="autenticidade") parts.push("símbolos de liberdade/individualidade (pássaros, chaves, bússola)");
    if(tags.values==="natureza") parts.push("elementos botânicos/animais em close para detalhes ricos");
    if(tags.values==="fe") parts.push("simbologia discreta (São Bento, cruz sutil, olho protetor)");

    if(tags.motive==="homenagem") parts.push("elementos pessoais do homenageado (data, objeto marcante ou caligrafia)");
    if(tags.motive==="expressao") parts.push("composição autoral combinando referência fotográfica e texturas");
    if(tags.motive==="atitude") parts.push("ângulos marcantes e enquadramento forte para imponência");

    if(tags.music==="rock") parts.push("texturas granuladas, luz de palco ou referência simbólica sutil");
    if(tags.music==="mpb") parts.push("orgânico e poético: plantas brasileiras, traços suaves");
    if(tags.music==="pop") parts.push("ícone cultural minimalista integrado ao motivo principal");
    if(tags.music==="rap") parts.push("contraste alto e elementos urbanos discretos");
    if(tags.music==="classica") parts.push("referência a esculturas e tratamento de luz clássico");

    return parts.length ? parts.join(". ") + "." : null;
  }

  function recommend(ans){
    const tags={};
    Object.values(ans).forEach(v=>{
      if(!v) return;
      if(Array.isArray(v)) v.forEach(o=>Object.assign(tags,o.tags||{}));
      else Object.assign(tags, v.tags||{});
    });

    const persona=tags.persona||"artistico";
    const universe=tags.universe;

    let themes=[...(THEME_BY_PERSONA[persona]||THEME_BY_PERSONA.artistico)];
    if(universe && CULTURE_MOD[universe]) themes=themes.concat(CULTURE_MOD[universe]);
    if(tags.tribute==="pessoa") themes.unshift("retrato de pessoa querida");
    if(tags.tribute==="pet")    themes.unshift("retrato do seu pet");
    if(tags.tribute==="fe")     themes.unshift("símbolo de fé/proteção");

    // locais
    let visKey=tags.vis||"media";
    let placements=[...(PLACEMENTS[visKey]||PLACEMENTS.media)];
    if(tags.first) placements=["antebraço interno","panturrilha","ombro",...placements];
    if(tags.volu==="alta") placements=[...LESS_SEEN,...placements];
    if(tags.work==="formal" && visKey!=="baixa") placements=[...LESS_SEEN,...PLACEMENTS.baixa];
    if(tags.pain==="baixa") placements=[...placements.filter(p=>LOW_PAIN.some(lp=>p.includes(lp))),...placements];

    const areas=(ans["areas"]||[]).map(o=>o.tags?.area);
    if(areas.length && !areas.includes("nenhuma")){
      const map={ braco:["antebraço","bíceps","ombro"], perna:["coxa","panturrilha"], costas:["costas"],
                  peito:["peito","tórax"], costela:["costela","lateral"], mao:["mão","punho"], pescoco:["pescoço"] };
      placements=placements.filter(p=>areas.some(a=>(map[a]||[]).some(kw=>p.includes(kw))));
      if(!placements.length){
        placements=[...(PLACEMENTS[visKey]||PLACEMENTS.media)];
      }
    }

    // tamanho
    const inv=ans["investimento"]?.tags || {budgetMin:600,budgetMax:1200};
    const hours=hoursFromBudget(inv.budgetMin,inv.budgetMax);
    const multi=ans["tempoSessao"]?.tags?.session==="multi" || inv.budgetMin>=2500;
    const size=sizeFromTime(hours,multi);
    const cm = SIZE_CM[size.size];

    // justificativa local/tamanho
    const just = [];
    if(tags.first) just.push("boa escolha para primeira tatuagem");
    if(tags.pain==="baixa") just.push("região de menor sensibilidade");
    if(tags.work==="formal") just.push("ajuda a manter discrição no trabalho");
    if(tags.volu==="alta") just.push("fica fora do campo de visão constante");
    if(tags.vis==="alta") just.push("boa visibilidade no dia a dia");
    if(tags.presence==="impactante") just.push("garante presença visual");
    const justification = `${just.length? just.join(" · "):"equilíbrio entre conforto e estética"} — tamanho aproximado ${cm} (${size.label}).`;

    const inspiration = buildInspiration(tags);

    return {
      persona,
      themes:[...new Set(themes)].slice(0,4),
      placementPrimary:placements[0] || "antebraço interno",
      sizeLabel:size.label,
      sizeCm:cm,
      justification,
      inspiration,
      tone:tone(persona),
      tags
    };
  }

  // ===== SERIALIZAÇÃO PARA ENVIO =====
  function serializeAnswersForSubmit(Q, answers) {
    const out = {};
    Q.forEach(q=>{
      const v = answers[q.id];
      if(!v) return;
      if(q.type === "text"){
        out[q.id] = v.value || "";
      } else if(q.type === "single"){
        out[q.id] = v.label || "";
        out[q.id+"_tags"] = v.tags || {};
      } else if(q.type === "multi"){
        const arr = Array.isArray(v) ? v : [];
        out[q.id] = arr.map(o=>o.label).join("; ");
        out[q.id+"_tags"] = arr.map(o=>o.tags||{});
      }
    });
    return out;
  }
  // evita </script> em dados embutidos no HTML
  const safeJSON = (obj)=> JSON.stringify(obj).replace(/</g, '\\u003C');

  // ===== UI =====
  const app=document.getElementById("app");
  let step=0;
  const answers={};
  const total=Q.length;
  let finished=false; // evita múltiplas janelas

  function finishOnce(){
    if(finished) return;
    finished = true;

    const r = recommend(answers);
    const nome = (answers.nome?.value||"Você");

    // Pacote de dados para submissão
    const RAW_OBJ = serializeAnswersForSubmit(Q, answers);
    const REC_OBJ = {
      themes: r.themes,
      placement: r.placementPrimary,
      sizeLabel: r.sizeLabel,
      sizeCm: r.sizeCm,
      justification: r.justification,
      inspiration: r.inspiration,
      persona: r.persona,
      tags: r.tags
    };

    const html =
`<!doctype html><html lang="pt-br"><head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Sugestão personalizada</title>
<style>
  :root{--bg:#f7f7f8;--card:#fff;--ink:#111;--muted:#666;--line:#e6e6e8;--radius:16px;--accent:#7A8B55;--accent-ink:#fff}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif}
  .wrap{max-width:860px;margin:0 auto;padding:24px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:0 6px 16px rgba(0,0,0,.04);padding:20px}
  .title{font-size:22px;margin:0 0 10px}
  .kicker{font-size:12px;text-transform:uppercase;color:var(--muted);margin-top:14px}
  .row{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:720px){.row2{grid-template-columns:1fr 1fr}}
  .btn{appearance:none;border:1px solid var(--accent);background:var(--accent);color:var(--accent-ink);border-radius:12px;padding:12px 14px;text-align:center;cursor:pointer}
  .btn:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
  input[type="text"]{width:100%;padding:12px;border:1px solid #d9d9df;border-radius:12px}
  .muted{color:#666}
</style>
</head><body>
<div class="wrap">
  <div class="card">
    <div class="title">${nome}, sua sugestão personalizada 🎨</div>

    <div class="kicker">Tema recomendado</div>
    <div style="font-size:18px;margin-top:4px">${r.themes[0]} — ${r.tone.themeLine}.</div>
    ${r.themes.slice(1).length ? `<div class="muted" style="margin-top:4px">Alternativas: ${r.themes.slice(1,4).join(" · ")}</div>` : ""}

    <div class="kicker">Local ideal</div>
    <div style="font-size:18px;margin-top:4px">${r.placementPrimary}</div>
    <div class="muted" style="margin-top:6px">Justificativa: ${r.justification}</div>

    ${r.inspiration ? `
      <div class="kicker">Inspiração adicional</div>
      <div style="font-size:16px;margin-top:4px">${r.inspiration}</div>` : ""}

    <div class="row row2" style="margin-top:14px">
      <a class="btn" href="https://wa.me/5534999199962" target="_blank" rel="noreferrer noopener">Quero conversar sobre minha ideia no WhatsApp</a>
      <button class="btn" id="copy">Copiar sugestão</button>
    </div>

    <div class="card" style="margin-top:14px;border-color:#efefef">
      <div><strong>Quer receber inspirações de desenhos</strong> para te ajudar na decisão? Deixe seu WhatsApp ou e-mail.
        <em>É só para inspirar, sem compromisso.</em></div>
      <div class="row" style="margin-top:8px">
        <input id="lead" type="text" placeholder="(DDD) WhatsApp ou e-mail"/>
        <button class="btn" id="send">Quero receber inspirações</button>
      </div>
      <div class="muted" style="margin-top:6px">Sem spam. Só inspirações úteis.</div>
    </div>
  </div>
</div>
<scr` + `ipt>
  // Dados vindos da página anterior, embutidos de forma segura
  const RAW = ${safeJSON(RAW_OBJ)};
  const REC = ${safeJSON(REC_OBJ)};
  const txt = ${JSON.stringify(`${nome} — Tema: ${r.themes[0]} | Local: ${r.placementPrimary} | Tamanho: ${r.sizeLabel} (${r.sizeCm})`)};

  document.getElementById("copy").addEventListener("click", ()=>navigator.clipboard.writeText(txt).then(()=>alert("Sugestão copiada!")).catch(()=>alert("Copie manualmente: "+txt)));

  const endpoint = ${FORMSPREE_ENDPOINT ? `"${FORMSPREE_ENDPOINT}"` : "''"};

  document.getElementById("send").addEventListener("click", async ()=>{
    const contato = (document.getElementById("lead").value||'').trim();
    if(!contato){ alert("Preencha seu WhatsApp ou e-mail."); return; }

    try{
      if(endpoint){
        await fetch(endpoint,{
          method:"POST",
          headers:{"Content-Type":"application/json","Accept":"application/json"},
          body:JSON.stringify({
            ts: new Date().toISOString(),
            nome: ${JSON.stringify(nome)},
            contato,
            resumo: REC,        // recomendação
            respostas: RAW,     // todas as respostas
            ua: navigator.userAgent
          })
        });
        alert("Contato registrado! Você receberá inspirações ✨");
        document.getElementById("lead").value="";
      }else{
        alert("Endpoint não configurado. Cole sua URL do Formspree no código (FORMSPREE_ENDPOINT).");
      }
    }catch(e){
      alert("Não foi possível enviar agora. Tente novamente.");
    }
  });
</scr` + `ipt>
</body></html>`;

    let w = window.open("", "_blank");
    if (w && w.document) {
      w.document.open(); w.document.write(html); w.document.close();
    } else {
      // fallback se pop-up estiver bloqueado
      const blob = new Blob([html], {type:"text/html"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.target = "_blank";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }
  }

  function render(){
    app.innerHTML="";
    const q=Q[step];

    const prog=el("div",{class:"prog"}, el("i",{style:`width:${Math.round(((step+1)/total)*100)}%`}));

    const card=el("div",{class:"card"},
      el("div",{class:"title"}, q.t),
      q.helper?el("div",{class:"muted"}, q.helper):null,
    );

    if(q.type==="text"){
      const input=el("input",{type:"text",placeholder:q.ph||"",value:answers[q.id]?.value||""});
      input.addEventListener("input", ()=> answers[q.id]={value:input.value,tags:{}});
      const actions=el("div",{class:"actions"},
        el("button",{class:"btn",onClick:()=>{step=Math.max(0,step-1);render();}}, "Voltar"),
        el("button",{class:"btn primary",onClick:()=>{
          if(q.req && !input.value.trim()){ alert("Digite seu nome"); return; }
          if(input.value.trim()) answers[q.id]={value:input.value.trim(),tags:{}};
          if(step === total-1){ finishOnce(); return; }
          step=Math.min(total-1,step+1); render();
        }},"Avançar"),
      );
      card.append(el("div",{class:"row"},input), actions);

    } else if(q.type==="single"){
      const selected = answers[q.id]?.__chosen ?? null; // índice 0 ok
      const list=el("div",{class:"row row2"});
      q.options.forEach((opt,idx)=>{
        const isSel = selected===idx;
        list.appendChild(
          el("button",{
            class:"btn"+(isSel?" sel":""),
            "aria-pressed": String(!!isSel),
            onClick:()=>{ answers[q.id]={...opt,__chosen:idx}; render(); }
          }, opt.label)
        );
      });
      const canNext = answers[q.id] && answers[q.id].__chosen != null;
      const actions=el("div",{class:"actions"},
        el("button",{class:"btn",onClick:()=>{step=Math.max(0,step-1);render();}}, "Voltar"),
        el("button",{class:"btn primary",disabled:!canNext,onClick:()=>{
          if(!canNext) return;
          if(step === total-1){ finishOnce(); return; }
          step=Math.min(total-1,step+1);
          render();
        }}, "Avançar")
      );
      card.append(list, actions);

    } else if(q.type==="multi"){
      const current = Array.isArray(answers[q.id])?answers[q.id]:[];
      const list=el("div",{class:"row row2"});
      q.options.forEach(opt=>{
        const sel = current.find(o=>o.label===opt.label);
        const isSel = !!sel;
        list.appendChild(el("button",{
          class:"btn"+(isSel?" sel":""),
          "aria-pressed": String(isSel),
          onClick:()=>{
            const arr=Array.isArray(answers[q.id])?[...answers[q.id]]:[];
            const i=arr.findIndex(o=>o.label===opt.label);
            if(i>=0) arr.splice(i,1); else arr.push(opt);
            answers[q.id]=arr; render();
          }}, opt.label));
      });
      const actions=el("div",{class:"actions"},
        el("button",{class:"btn",onClick:()=>{step=Math.max(0,step-1);render();}}, "Voltar"),
        el("button",{class:"btn primary",onClick:()=>{
          if(step === total-1){ finishOnce(); return; }
          step=Math.min(total-1,step+1); render();
        }}, "Avançar"),
      );
      card.append(list,actions);
    }

    app.append(prog,card);
  }

  document.getElementById("year").textContent=new Date().getFullYear();
  render();
})();
</script>
</body>
</html>
